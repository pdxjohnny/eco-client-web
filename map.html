<!DOCTYPE html>
<html>
<head>
  <!-- Standard Meta -->
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <!-- Site Properities -->
  <title>Map</title>
  <link rel="stylesheet" type="text/css" href="bower_components/semantic/dist/semantic.min.css">

</head>
<body>


  <div class="pusher">
    <div class="ui inverted vertical masthead center aligned segment">

      <div class="ui container">
        <div class="ui large secondary inverted pointing menu">
          <a class="item" href="index.html">
            Home
          </a>
          <a class="active item" href="map.html">
            Map
          </a>
          <!--
          <div class="right menu small">
            <div class="item">
              <div class="ui icon input">
                <input id="thing_search" type="text" placeholder="Search...">
                <i class="search link icon"></i>
              </div>
            </div>
          </div>
          -->
        </div>
      </div>

    </div>
  </div>

  <div id="map" data-tap-disabled="true"></div>
  <script>

  function initMap() {
    var center = {};
    API.GetLocation(function (data) {
      console.log('Got location', data);
      center.lng = data.coords.longitude;
      center.lat = data.coords.latitude;

      var map = new google.maps.Map(document.getElementById('map'), {
        zoom: 10,
        center: center
      });

      var options = {
        longitude: center.lng,
         latitude: center.lat,
         radius: 10 * 5000
      };
      API.GetNear(options, function (data) {
        console.log('Got things', data);

        for (var i = 0; i < data['rows'].length; i++) {
          var thing = data['rows'][i];
            console.log('Got thing', thing);
            (function (thing) {
              var position = {};
              position.lng = Number(thing.longitude);
              position.lat = Number(thing.latitude);

              var marker = new google.maps.Marker({
                position: position,
                map: map,
                title: thing.name
              });

              var interact = function() {
                map.setCenter(marker.getPosition());
                $('.ui.modal').modal('show');
                for (var prop in thing) {
                  if (thing.hasOwnProperty(prop)) {
                    $('#'+prop).text(thing[prop]);
                  }
                }
              };
              // marker.addListener('click', interact);
              google.maps.event.addListener(marker, 'click', interact);
              // marker.addListener('mousedown', interact);
            })(thing);
          }
      },
      function (data) {
        console.error('ERROR getting near', data);
      }
    );
    },
    function (data) {
      console.error('ERROR getting location', data);
    }
  );
}

  </script>


  <div class="ui card modal">
    <div class="image small">
      <img src="assets/images/no-image.png" />
    </div>
    <div class="content">
      <a id="name" class="header">Name</a>
      <div class="meta">
        <!-- <span class="date">Joined in 2013</span> -->
      </div>
      <div id="description" class="description">
        Description
      </div>
    </div>
    <div class="extra content">
      <!-- <a>
        <i class="user icon"></i>
        22 Friends
      </a>
      -->
    </div>
  </div>

<style type="text/css">
  body {
    background-color: #DADADA;
  }
  body > .grid {
    height: 100%;
  }
  .image {
    margin-top: -100px;
  }
  .column {
    max-width: 450px;
  }
  html, body {
    height: 100%;
    margin: 0;
    padding: 0;
  }
  #map {
    height: 100%;
  }
</style>

<script src="bower_components/jquery/dist/jquery.min.js" charset="utf-8"></script>
<script src="bower_components/semantic/dist/semantic.min.js" charset="utf-8"></script>

<script src="js/global.js" charset="utf-8"></script>
<script src="js/api.js" charset="utf-8"></script>
<script src="js/link.js" charset="utf-8"></script>
<script src="js/result.js" charset="utf-8"></script>
<script src="js/item.js" charset="utf-8"></script>
<script src="js/form.js" charset="utf-8"></script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAF3-mhc-PArqMLukKDVVX_ch9ZU7D4VhU&signed_in=true&callback=initMap"></script>

</body>
</html>
